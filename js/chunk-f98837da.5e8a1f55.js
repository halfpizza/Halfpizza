/*!
 *  build: admin-pro 
 *  copyright: chuzhixin 1204505056@qq.com 
 *  time: 2021-11-7 15:40:52
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f98837da"],{"1b62":function(e,t,r){"use strict";r.r(t);var a=r("1da1"),n=r("5530"),s=(r("96cf"),r("d3b7"),r("a9e3"),r("c030")),i=r("2f62");t["default"]={name:"Game1",computed:Object(n["a"])({},Object(i["c"])({address:"connect/address",chainID:"connect/chainID"})),methods:{userbalance:function(){var e=this;return new Promise((function(t){if(!e.address||e.chainID!==e.runChainID)return t(0),!1;var r=new s["a"].providers.Web3Provider(window.ethereum),a=new s["a"].Contract(e.metamask.contractAddressPizza,e.metamask.contractAbiPizza,r);a.balanceOf(e.address).then(t).catch((function(){t(0)}))}))},allowance:function(e,t,r){return Object(a["a"])(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.t0=Number,a.next=3,e.allowance(t,r);case 3:return a.t1=a.sent,a.abrupt("return",(0,a.t0)(a.t1));case 5:case"end":return a.stop()}}),a)})))()},waitSuccessApprove:function(e,t,r,n){var s=this;return new Promise((function(i){var o=0,c=setInterval(Object(a["a"])(regeneratorRuntime.mark((function a(){var u;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return o++,a.next=3,s.allowance(e,r,n);case 3:u=a.sent,u>=Number(t)?(clearInterval(c),i(!0)):o>60&&(i(!1),clearInterval(c));case 5:case"end":return a.stop()}}),a)}))),1e3)}))},approve:function(e){var t=this;return new Promise(function(){var r=Object(a["a"])(regeneratorRuntime.mark((function r(a){var n,i,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.chainID===t.runChainID&&t.address||a(!1),n=new s["a"].providers.Web3Provider(window.ethereum),i=new s["a"].Contract(t.metamask.contractAddressPizza,t.metamask.contractAbiPizza,n),r.next=5,t.allowance(i,t.address,t.metamask.contractAddress);case 5:if(o=r.sent,!(o>=1e18*Number(e))){r.next=9;break}return a(!0),r.abrupt("return",!1);case 9:e+="000000000000000000",i.connect(n.getSigner()).approve(t.metamask.contractAddress,e+"000000000").then((function(){t.waitSuccessApprove(i,e,t.address,t.metamask.contractAddress).then(a)})).catch((function(){a(!1)}));case 11:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}}}},"4a88":function(e,t,r){},7998:function(e,t,r){"use strict";r.r(t),r.d(t,"getList",(function(){return n})),r.d(t,"getList1",(function(){return s})),r.d(t,"getTotal",(function(){return i})),r.d(t,"doAdd",(function(){return o})),r.d(t,"doVoteAdd",(function(){return c})),r.d(t,"doUpdata",(function(){return u})),r.d(t,"getSum",(function(){return l})),r.d(t,"getPrice",(function(){return d}));var a=r("b775");function n(e){return Object(a["default"])({url:"/list.php",method:"post",data:e})}function s(e){return Object(a["default"])({url:"/list1.php",method:"post",data:e})}function i(e){return Object(a["default"])({url:"/total.php",method:"post",data:e})}function o(e){return Object(a["default"])({url:"/add.php",method:"post",data:e})}function c(e){return Object(a["default"])({url:"/voteinfo.php",method:"post",data:e})}function u(e){return Object(a["default"])({url:"/updata.php",method:"post",data:e})}function l(e){return Object(a["default"])({url:"/sum.php",method:"post",data:e})}function d(){return Object(a["default"])({baseURL:"https://halfpizza.info:5000/",url:"/",method:"get"})}},"79fd":function(e,t,r){"use strict";r("4a88")},"9da6":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"community-container"},[r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[r("a",{staticClass:"goBack",attrs:{href:"javascript:void(0);"},on:{click:e.goBack}},[r("p",[e._v("← "+e._s(e.translateTitle("返回")))])])]),r("el-col",{attrs:{lg:18,md:18,sm:18,xl:18,xs:24}},[r("div",{staticClass:"grid-l"},[r("div",{staticClass:"btn"},[1==e.$route.params.state?r("el-button",{attrs:{round:""}},[e._v(" "+e._s(e.translateTitle("立即投票"))+" ")]):e._e(),2==e.$route.params.state?r("el-button",{attrs:{round:"",type:"danger"}},[e._v(" "+e._s(e.translateTitle("即将开始"))+" ")]):e._e(),3==e.$route.params.state?r("el-button",{attrs:{round:"",type:"info"}},[e._v(" "+e._s(e.translateTitle("已关闭"))+" ")]):e._e(),r("el-button",{attrs:{round:""}},[e._v(e._s(e.translateTitle(e.item.category)))])],1),r("h1",[e._v(e._s(e.item.title))]),r("div",{staticClass:"content",domProps:{innerHTML:e._s(e.item.content)}}),e.voteinfo?r("div",{staticClass:"votes",staticStyle:{"margin-bottom":"10px"}},[r("div",{staticClass:"title"},[r("strong",[e._v(e._s(e.translateTitle("进行投票")))])]),r("div",{staticClass:"outside"},[r("div",{staticClass:"radio"},e._l(e.optionsList,(function(t,a){return r("p",{key:a},[r("el-radio",{attrs:{border:"",label:t.id},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}},[e._v(" "+e._s(t.name)+" ")])],1)})),0),r("p",{staticClass:"confirmationvote"},[r("el-button",{attrs:{round:""},on:{click:e.voteinfoclick}},[e._v(" "+e._s(e.translateTitle("确认投票"))+" ")])],1)])]):e._e(),e.votesnum>0?r("div",{staticClass:"votes"},[r("div",{staticClass:"title"},[r("strong",[e._v(e._s(e.translateTitle("票数"))+"（"+e._s(e.votesnum)+"）")])]),r("div",{staticClass:"outside"},[r("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,stripe:""}},[r("el-table-column",{attrs:{label:e.translateTitle("投票人"),prop:"voter",width:"140"}}),r("el-table-column",{attrs:{label:e.translateTitle("决定"),prop:"decision"}})],1),r("div",{staticClass:"details"},[e.nextPage?r("a",{attrs:{href:"javascript:void(0)"},on:{click:e.hideclick}},[r("p",{staticClass:"hide"},[e._v(e._s(e.translateTitle("点击加载更多")))])]):r("p",{staticClass:"hide"},[e._v(e._s(e.translateTitle("已经到底了")))])])],1)]):e._e()])]),r("el-col",{attrs:{lg:6,md:6,sm:6,xl:6,xs:24}},[r("div",{staticClass:"grid-r"},[r("div",{staticClass:"votes",staticStyle:{"margin-bottom":"10px"}},[r("div",{staticClass:"title"},[r("strong",[e._v(e._s(e.translateTitle("细节")))])]),r("div",{staticClass:"outside"},[r("div",{staticClass:"details"},[r("p",[e._v(" ID： "),r("span",[e._v(e._s(e.item.id))])]),r("p",[e._v(" "+e._s(e.translateTitle("发布人"))+"： "),r("span",[e._v(" "+e._s(e.item.publisher&&e.item.publisher.substring(0,4)+"..."+e.item.publisher.substring(e.item.publisher.length-5,e.item.publisher.length-1))+" ")])]),r("div",{staticClass:"time"},[r("p",[e._v(e._s(e.translateTitle("开始日期"))+" "+e._s(e.item.startTime))]),r("p",[e._v(e._s(e.translateTitle("结束日期"))+" "+e._s(e.item.endTime))])])])])]),e.votesnum>0?r("div",{staticClass:"votes"},[r("div",{staticClass:"title"},[r("strong",[e._v(e._s(e.translateTitle("当前结果")))])]),r("div",{staticClass:"outside"},e._l(e.optionsList,(function(t,a){return r("div",{key:a,staticClass:"currentresults"},[r("p",[e._v(e._s(t.name))]),r("el-progress",{attrs:{percentage:t.percentage?t.percentage:0,type:"circle"}}),r("p",[e._v(e._s(t.total)+" "+e._s(e.translateTitle("票")))])],1)})),0)]):e._e()])])],1)],1)},n=[],s=r("1da1"),i=r("5530"),o=(r("d3b7"),r("d81d"),r("99af"),r("25f0"),r("96cf"),r("79fa")),c=r("7998"),u=r("2f62"),l=r("1b62"),d=r("c030"),p={name:"Community",components:{},mixins:[l["default"]],data:function(){return{radio:"",item:{},tableData:[],voteinfo:!1,optionsList:[],votesnum:0,nextPage:!0,pagesize:10,pageno:1}},computed:Object(i["a"])({},Object(u["c"])({metamask:"settings/metamask"})),created:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.$baseLoading(3),t.next=3,e.getList();case 3:return t.next=5,e.getoptions();case 5:return t.next=7,e.tablevoteinfo();case 7:return t.next=9,e.getTotal("where publisher='"+e.address+"' AND voteid="+e.$route.params.id);case 9:return a=t.sent,e.voteinfo=0==a,t.next=13,e.getTotal("where voteid="+e.$route.params.id);case 13:e.votesnum=t.sent,r.close();case 15:case"end":return t.stop()}}),t)})))()},mounted:function(){},methods:{translateTitle:o["translateTitle"],transfer:function(e){var t=this;return new Promise((function(r){t.chainID!==t.runChainID&&r(!1);var a=new d["a"].providers.Web3Provider(window.ethereum),n=new d["a"].Contract(t.metamask.contractAddressPizza,t.metamask.contractAbiPizza,a),s=a.getSigner();e+="000000000000000000",n.connect(s).transfer(t.metamask.contractAddress,e).then((function(){r(!0)})).catch((function(){r(!1)}))}))},getList:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,a,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r="where id="+e.$route.params.id,t.next=3,Object(c["getList"])({tab_name:"vote",cont:r,cont2:r});case 3:if(a=t.sent,n=a.date,n){t.next=8;break}return e.$message.error("An exception occurs on the backend. Contact the webmaster！"),t.abrupt("return",!1);case 8:e.item=n[0];case 9:case"end":return t.stop()}}),t)})))()},getoptions:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,a,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r="where voteid="+e.$route.params.id,t.next=3,Object(c["getList"])({tab_name:"options",cont:r,cont2:r,selt:",(SELECT count(*) FROM voteinfo where voteid=options.voteid AND optionsid=options.id) as total"});case 3:if(a=t.sent,n=a.date,n){t.next=8;break}return e.$message.error("An exception occurs on the backend. Contact the webmaster！"),t.abrupt("return",!1);case 8:return t.next=10,e.getTotal("where voteid="+e.$route.params.id);case 10:s=t.sent,e.optionsList=n.map((function(e){return e.percentage=e.total/s*100,e}));case 12:case"end":return t.stop()}}),t)})))()},tablevoteinfo:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,a,n,s,i,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=(e.pageno-1)*e.pagesize,a="where voteid="+e.$route.params.id,t.next=4,Object(c["getList"])({tab_name:"voteinfo",cont:a+" ORDER BY id DESC limit "+r+","+e.pagesize,cont2:a,selt:",(SELECT name FROM options where id=voteinfo.optionsid) as optionsname"});case 4:if(n=t.sent,s=n.date,i=n.total,s){t.next=10;break}return e.$message.error("An exception occurs on the backend. Contact the webmaster！"),t.abrupt("return",!1);case 10:e.tableData=1==e.pageno?s:e.tableData.concat(s),e.tableData=s.map((function(e){return{voter:e.publisher.substring(0,4)+"..."+e.publisher.substring(e.publisher.length-5,e.publisher.length-1),decision:e.optionsname}})),o=Math.ceil(i/e.pagesize),(o<=e.pageno||e.pagesize>=i)&&(e.nextPage=!1);case 14:case"end":return t.stop()}}),t)})))()},hideclick:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=e.$baseLoading(3),e.pageno++,t.next=4,e.tablevoteinfo();case 4:r.close();case 5:case"end":return t.stop()}}),t)})))()},getTotal:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,Object(c["getTotal"])({tab_name:"voteinfo",cont:e});case 2:if(a=r.sent,a){r.next=6;break}return t.$message.error("An exception occurs on the backend. Contact the webmaster！"),r.abrupt("return",!1);case 6:return r.abrupt("return",a);case 7:case"end":return r.stop()}}),r)})))()},voteinfoclick:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var r,a,n,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=e.$baseLoading(3,e.translateTitle("投票执行中")+"..."),e.radio){t.next=5;break}return e.$message.error(e.translateTitle("请先选择投票项")),r.close(),t.abrupt("return",!1);case 5:if(e.address){t.next=9;break}return e.$message.warning(e.translateTitle("mustConnectWallet")),r.close(),t.abrupt("return",!1);case 9:if(e.chainID===e.runChainID){t.next=13;break}return e.$message.warning(e.translateTitle("changeBsc")),r.close(),t.abrupt("return",!1);case 13:return t.next=15,e.approve("500");case 15:if(a=t.sent,a){t.next=20;break}return e.$message.error("add vote fail, get the user approve fail"),r.close(),t.abrupt("return",!1);case 20:return t.next=22,e.transfer("500");case 22:if(n=t.sent,n){t.next=27;break}return e.$message.error("Payment failed！"),r.close(),t.abrupt("return",!1);case 27:return t.next=29,Object(c["doVoteAdd"])({id:Math.round((new Date).getTime()/1e3).toString(),publisher:e.address,voteid:e.$route.params.id,optionsid:e.radio});case 29:if(s=t.sent,s){t.next=35;break}return e.voteinfo=!1,e.$message.error(e.translateTitle("投票失败")+"！"),r.close(),t.abrupt("return",!1);case 35:return e.voteinfo=!1,e.pageno=1,e.getoptions(),e.tablevoteinfo(),t.next=41,e.getTotal("where voteid="+e.$route.params.id);case 41:e.votesnum=t.sent,e.$alert(e.translateTitle("投票成功")+"！",{confirmButtonText:"确定",customClass:"messagealert",showClose:!1}),r.close();case 44:case"end":return t.stop()}}),t)})))()},goBack:function(){this.$router.push({path:"/community"})}}},m=p,f=(r("79fd"),r("a6dc"),r("2877")),v=Object(f["a"])(m,a,n,!1,null,"d4305066",null);t["default"]=v.exports},a6dc:function(e,t,r){"use strict";r("a717")},a717:function(e,t,r){e.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},b775:function(e,t,r){"use strict";r.r(t);var a,n=r("1da1"),s=r("2909"),i=(r("96cf"),r("99af"),r("caad"),r("2532"),r("d3b7"),r("a026")),o=r("bc3a"),c=r.n(o),u=r("f121"),l=r("4360"),d=r("4328"),p=r.n(d),m=r("a18c"),f=r("61f7"),v=r("0a48"),b=Object(f["isArray"])(u["successCode"])?Object(s["a"])(u["successCode"]):[u["successCode"]].concat(),h={200:"服务器成功返回请求数据",201:"新建或修改数据成功",202:"一个请求已经进入后台排队(异步任务)",204:"删除数据成功",400:"发出信息有误",401:"用户没有权限(令牌失效、用户名、密码错误、登录过期)",402:"令牌过期",403:"用户得到授权，但是访问是被禁止的",404:"访问资源不存在",406:"请求格式不可得",410:"请求资源被永久删除，且不会被看到",500:"服务器发生错误",502:"网关错误",503:"服务不可用，服务器暂时过载或维护",504:"网关超时"},g=function(e){return e.data&&"application/x-www-form-urlencoded;charset=UTF-8"===e.headers["Content-Type"]&&(e.data=p.a.stringify(e.data)),u["debounce"].some((function(t){return e.url.includes(t)}))&&(a=i["default"].prototype.$baseLoading()),e},w=function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(t){var r,n,s,o,c,d,p;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=t.config,n=t.data,s=t.status,o=t.statusText,a&&a.close(),c=n&&n[u["statusName"]]?n[u["statusName"]]:s,b.indexOf(n[u["statusName"]])+1&&(c=200),e.t0=c,e.next=200===e.t0?7:403===e.t0?8:10;break;case 7:return e.abrupt("return",n);case 8:return m["default"].push({path:"/403"}).then((function(){})),e.abrupt("break",10);case 10:return d="".concat(r.url," 后端接口 ").concat(c," 异常：").concat(n&&n[u["messageName"]]?n[u["messageName"]]:h[c]?h[c]:o),i["default"].prototype.$baseMessage(d,"error","vab-hey-message-error"),p=new Error(d),Object(v["checkNeed"])()&&l["default"].dispatch("errorLog/addErrorLog",{err:p,url:r.url}).then((function(){})),e.abrupt("return",Promise.reject(p));case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),x=c.a.create({baseURL:u["baseURL"],timeout:u["requestTimeout"],headers:{"Content-Type":u["contentType"]}});x.interceptors.request.use(g,(function(e){return Promise.reject(e)})),x.interceptors.response.use((function(e){return w(e)}),(function(e){var t=e.response;return void 0===t?(i["default"].prototype.$baseMessage("未可知错误，大部分是由于后端不支持跨域CORS或无效配置引起","error","vab-hey-message-error"),{}):w(t)})),t["default"]=x}}]);