/*!
 *  build: admin-pro 
 *  copyright: chuzhixin 1204505056@qq.com 
 *  time: 2021-11-7 15:40:52
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fbf0fd56"],{"1b62":function(e,t,r){"use strict";r.r(t);var n=r("1da1"),a=r("5530"),s=(r("96cf"),r("d3b7"),r("a9e3"),r("c030")),i=r("2f62");t["default"]={name:"Game1",computed:Object(a["a"])({},Object(i["c"])({address:"connect/address",chainID:"connect/chainID"})),methods:{userbalance:function(){var e=this;return new Promise((function(t){if(!e.address||e.chainID!==e.runChainID)return t(0),!1;var r=new s["a"].providers.Web3Provider(window.ethereum),n=new s["a"].Contract(e.metamask.contractAddressPizza,e.metamask.contractAbiPizza,r);n.balanceOf(e.address).then(t).catch((function(){t(0)}))}))},allowance:function(e,t,r){return Object(n["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.t0=Number,n.next=3,e.allowance(t,r);case 3:return n.t1=n.sent,n.abrupt("return",(0,n.t0)(n.t1));case 5:case"end":return n.stop()}}),n)})))()},waitSuccessApprove:function(e,t,r,a){var s=this;return new Promise((function(i){var o=0,c=setInterval(Object(n["a"])(regeneratorRuntime.mark((function n(){var l;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o++,n.next=3,s.allowance(e,r,a);case 3:l=n.sent,l>=Number(t)?(clearInterval(c),i(!0)):o>60&&(i(!1),clearInterval(c));case 5:case"end":return n.stop()}}),n)}))),1e3)}))},approve:function(e){var t=this;return new Promise(function(){var r=Object(n["a"])(regeneratorRuntime.mark((function r(n){var a,i,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.chainID===t.runChainID&&t.address||n(!1),a=new s["a"].providers.Web3Provider(window.ethereum),i=new s["a"].Contract(t.metamask.contractAddressPizza,t.metamask.contractAbiPizza,a),r.next=5,t.allowance(i,t.address,t.metamask.contractAddress);case 5:if(o=r.sent,!(o>=1e18*Number(e))){r.next=9;break}return n(!0),r.abrupt("return",!1);case 9:e+="000000000000000000",i.connect(a.getSigner()).approve(t.metamask.contractAddress,e+"000000000").then((function(){t.waitSuccessApprove(i,e,t.address,t.metamask.contractAddress).then(n)})).catch((function(){n(!1)}));case 11:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}())}}}},"2a37":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"community-container"},[r("el-row",{attrs:{gutter:10}},[r("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[r("a",{staticClass:"goBack",attrs:{href:"javascript:void(0);"},on:{click:e.goBack}},[r("p",[e._v("← "+e._s(e.translateTitle("返回")))])])]),r("el-col",{attrs:{lg:24,md:24,sm:24,xl:24,xs:24}},[r("el-form",{ref:"formLabelAlign",attrs:{"label-position":"top","label-width":"80px",model:e.formLabelAlign,rules:e.rules}},[r("el-form-item",{attrs:{label:e.translateTitle("标题"),prop:"title"}},[r("el-input",{attrs:{placeholder:e.translateTitle("请输入标题")},model:{value:e.formLabelAlign.title,callback:function(t){e.$set(e.formLabelAlign,"title",t)},expression:"formLabelAlign.title"}})],1),r("el-form-item",{attrs:{label:e.translateTitle("类别"),prop:"category"}},[r("el-select",{attrs:{placeholder:e.translateTitle("请选择类别")},model:{value:e.formLabelAlign.category,callback:function(t){e.$set(e.formLabelAlign,"category",t)},expression:"formLabelAlign.category"}},[r("el-option",{attrs:{label:e.translateTitle("核心"),value:e.translateTitle("核心")}}),r("el-option",{attrs:{label:e.translateTitle("社区"),value:e.translateTitle("社区")}})],1)],1),r("el-form-item",{attrs:{label:e.translateTitle("时间"),prop:"date"}},[r("el-date-picker",{attrs:{align:"right","end-placeholder":e.translateTitle("结束日期"),"range-separator":e.translateTitle("至"),"start-placeholder":e.translateTitle("开始日期"),type:"datetimerange"},model:{value:e.formLabelAlign.date,callback:function(t){e.$set(e.formLabelAlign,"date",t)},expression:"formLabelAlign.date"}})],1),r("el-form-item",{attrs:{label:e.translateTitle("选项"),prop:"dynamicTags"}},[e._l(e.formLabelAlign.dynamicTags,(function(t){return r("el-tag",{key:t,attrs:{closable:"","disable-transitions":!1},on:{close:function(r){return e.handleClose(t)}}},[e._v(" "+e._s(t)+" ")])})),e.inputVisible?r("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:e.handleInputConfirm},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm.apply(null,arguments)}},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}}):e._e(),r("el-button",{staticClass:"button-new-tag",attrs:{circle:"",icon:"el-icon-plus",type:"danger"},on:{click:e.showInput}})],2),r("el-form-item",{attrs:{label:e.translateTitle("内容"),prop:"content"}},[r("vab-markdown-editor",{ref:"mde",on:{"show-html":e.handleShowHtml},model:{value:e.formLabelAlign.content,callback:function(t){e.$set(e.formLabelAlign,"content",t)},expression:"formLabelAlign.content"}})],1),r("el-form-item",[r("el-button",{staticClass:"button-form",on:{click:function(t){return e.addClick("formLabelAlign")}}},[e._v(" "+e._s(e.translateTitle("发布"))+" ")])],1)],1)],1)],1)],1)},a=[],s=r("1da1"),i=r("5530"),o=(r("96cf"),r("d3b7"),r("a434"),r("25f0"),r("79fa")),c=r("cb7d"),l=r("7998"),u=r("2f62"),d=r("1b62"),m=r("c030"),f={name:"Community",components:{VabMarkdownEditor:c["default"]},mixins:[d["default"]],data:function(){return{formLabelAlign:{title:"",category:"",date:"",content:"",contenthtml:"",dynamicTags:[]},inputVisible:!1,inputValue:"",rules:{title:[{required:!0,message:this.translateTitle("请输入标题"),trigger:"blur"},{min:3,max:100,message:this.translateTitle("长度在3到100个字符"),trigger:"blur"}],category:[{required:!0,message:this.translateTitle("请选择类别"),trigger:"change"}],date:[{required:!0,message:this.translateTitle("请选择时间"),trigger:"change"}],dynamicTags:[{required:!0,message:this.translateTitle("请输入选项"),trigger:"blur"}],content:[{required:!0,message:this.translateTitle("请输入内容"),trigger:"blur"}]}}},computed:Object(i["a"])({},Object(u["c"])({metamask:"settings/metamask"})),methods:{translateTitle:o["translateTitle"],transfer:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.abrupt("return",new Promise((function(r){t.chainID!==t.runChainID&&r(!1);var n=new m["a"].providers.Web3Provider(window.ethereum),a=new m["a"].Contract(t.metamask.contractAddressPizza,t.metamask.contractAbiPizza,n),s=n.getSigner();e+="000000000000000000",a.connect(s).transfer(t.metamask.contractAddress,e).then((function(){r(!0)})).catch((function(){r(!1)}))})));case 1:case"end":return r.stop()}}),r)})))()},goBack:function(){this.$router.push({path:"/community"})},handleClose:function(e){this.formLabelAlign.dynamicTags.splice(this.formLabelAlign.dynamicTags.indexOf(e),1)},showInput:function(){var e=this;this.inputVisible=!0,this.$nextTick((function(){e.$refs.saveTagInput.$refs.input.focus()}))},handleInputConfirm:function(){var e=this.inputValue;e&&this.formLabelAlign.dynamicTags.push(e),this.inputVisible=!1,this.inputValue=""},handleShowHtml:function(e){this.formLabelAlign.contenthtml=e},addClick:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function r(){var n,a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t.address){r.next=3;break}return t.$message.warning(t.translateTitle("mustConnectWallet")),r.abrupt("return",!1);case 3:if(t.chainID===t.runChainID){r.next=6;break}return t.$message.warning(t.translateTitle("changeBsc")),r.abrupt("return",!1);case 6:return n=t.$baseLoading(3,t.translateTitle("投票发布中")+"..."),a=1e25,r.next=10,t.userbalance();case 10:if(r.t0=r.sent,r.t1=a,!(r.t0<r.t1)){r.next=16;break}return t.$message.error(t.translateTitle("钱包金额必须大于10000000才可投票")+"！"),n.close(),r.abrupt("return",!1);case 16:t.$refs[e].validate(function(){var e=Object(s["a"])(regeneratorRuntime.mark((function e(r){var a,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r){e.next=4;break}return t.$message.error(t.translateTitle("表单存在错误项")+"！"),n.close(),e.abrupt("return",!1);case 4:return e.next=6,t.approve("10000");case 6:if(a=e.sent,a){e.next=11;break}return t.$message.error("add vote fail, get the user approve fail"),n.close(),e.abrupt("return",!1);case 11:return e.next=13,t.transfer("10000");case 13:if(s=e.sent,s){e.next=18;break}return t.$message.error("Payment failed！"),n.close(),e.abrupt("return",!1);case 18:Object(l["doAdd"])({id:Math.round((new Date).getTime()/1e3).toString(),title:t.formLabelAlign.title,category:t.formLabelAlign.category,startTime:t.formLabelAlign.date[0],endTime:t.formLabelAlign.date[1],content:t.formLabelAlign.contenthtml,publisher:t.address,option:t.formLabelAlign.dynamicTags}).then((function(){t.$alert(t.translateTitle("投票发布成功")+"！",{confirmButtonText:"确定",customClass:"messagealert",showClose:!1}),t.goBack(),n.close()})).catch((function(){return t.$message.error(t.translateTitle("发生异常错误")+"！"),n.close(),!1}));case 19:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 17:case"end":return r.stop()}}),r)})))()}}},p=f,b=(r("ad48"),r("7051"),r("2877")),g=Object(b["a"])(p,n,a,!1,null,"6b61f3ca",null);t["default"]=g.exports},6372:function(e,t,r){},7051:function(e,t,r){"use strict";r("b0e9")},7998:function(e,t,r){"use strict";r.r(t),r.d(t,"getList",(function(){return a})),r.d(t,"getList1",(function(){return s})),r.d(t,"getTotal",(function(){return i})),r.d(t,"doAdd",(function(){return o})),r.d(t,"doVoteAdd",(function(){return c})),r.d(t,"doUpdata",(function(){return l})),r.d(t,"getSum",(function(){return u})),r.d(t,"getPrice",(function(){return d}));var n=r("b775");function a(e){return Object(n["default"])({url:"/list.php",method:"post",data:e})}function s(e){return Object(n["default"])({url:"/list1.php",method:"post",data:e})}function i(e){return Object(n["default"])({url:"/total.php",method:"post",data:e})}function o(e){return Object(n["default"])({url:"/add.php",method:"post",data:e})}function c(e){return Object(n["default"])({url:"/voteinfo.php",method:"post",data:e})}function l(e){return Object(n["default"])({url:"/updata.php",method:"post",data:e})}function u(e){return Object(n["default"])({url:"/sum.php",method:"post",data:e})}function d(){return Object(n["default"])({baseURL:"https://halfpizza.info:5000/",url:"/",method:"get"})}},ad48:function(e,t,r){"use strict";r("6372")},b0e9:function(e,t,r){e.exports={"menu-color":"rgba(255,255,255,.95)","menu-color-active":"rgba(255,255,255,.95)","menu-background":"#282c34","column-second-menu-background":"#fff"}},b775:function(e,t,r){"use strict";r.r(t);var n,a=r("1da1"),s=r("2909"),i=(r("96cf"),r("99af"),r("caad"),r("2532"),r("d3b7"),r("a026")),o=r("bc3a"),c=r.n(o),l=r("f121"),u=r("4360"),d=r("4328"),m=r.n(d),f=r("a18c"),p=r("61f7"),b=r("0a48"),g=Object(p["isArray"])(l["successCode"])?Object(s["a"])(l["successCode"]):[l["successCode"]].concat(),h={200:"服务器成功返回请求数据",201:"新建或修改数据成功",202:"一个请求已经进入后台排队(异步任务)",204:"删除数据成功",400:"发出信息有误",401:"用户没有权限(令牌失效、用户名、密码错误、登录过期)",402:"令牌过期",403:"用户得到授权，但是访问是被禁止的",404:"访问资源不存在",406:"请求格式不可得",410:"请求资源被永久删除，且不会被看到",500:"服务器发生错误",502:"网关错误",503:"服务不可用，服务器暂时过载或维护",504:"网关超时"},v=function(e){return e.data&&"application/x-www-form-urlencoded;charset=UTF-8"===e.headers["Content-Type"]&&(e.data=m.a.stringify(e.data)),l["debounce"].some((function(t){return e.url.includes(t)}))&&(n=i["default"].prototype.$baseLoading()),e},w=function(){var e=Object(a["a"])(regeneratorRuntime.mark((function e(t){var r,a,s,o,c,d,m;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=t.config,a=t.data,s=t.status,o=t.statusText,n&&n.close(),c=a&&a[l["statusName"]]?a[l["statusName"]]:s,g.indexOf(a[l["statusName"]])+1&&(c=200),e.t0=c,e.next=200===e.t0?7:403===e.t0?8:10;break;case 7:return e.abrupt("return",a);case 8:return f["default"].push({path:"/403"}).then((function(){})),e.abrupt("break",10);case 10:return d="".concat(r.url," 后端接口 ").concat(c," 异常：").concat(a&&a[l["messageName"]]?a[l["messageName"]]:h[c]?h[c]:o),i["default"].prototype.$baseMessage(d,"error","vab-hey-message-error"),m=new Error(d),Object(b["checkNeed"])()&&u["default"].dispatch("errorLog/addErrorLog",{err:m,url:r.url}).then((function(){})),e.abrupt("return",Promise.reject(m));case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),k=c.a.create({baseURL:l["baseURL"],timeout:l["requestTimeout"],headers:{"Content-Type":l["contentType"]}});k.interceptors.request.use(v,(function(e){return Promise.reject(e)})),k.interceptors.response.use((function(e){return w(e)}),(function(e){var t=e.response;return void 0===t?(i["default"].prototype.$baseMessage("未可知错误，大部分是由于后端不支持跨域CORS或无效配置引起","error","vab-hey-message-error"),{}):w(t)})),t["default"]=k}}]);